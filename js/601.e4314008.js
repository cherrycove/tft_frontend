"use strict";(self["webpackChunktft_frontend"]=self["webpackChunktft_frontend"]||[]).push([[601],{1601:function(a,t,e){e.r(t),e.d(t,{default:function(){return B}});var s=e(641),l=e(33);const n={class:"admin-container"},o={class:"generation-status"},i={class:"data-management"},r={class:"data-stats"},c={class:"stat-item"},u={class:"stat-value"},d={class:"data-actions"},p={class:"data-stats"},k={class:"stat-item"},v={class:"stat-value"},g={class:"stat-item"},m={class:"stat-value"},h={class:"stat-item"},b={class:"stat-value"},f={class:"data-actions"},F={class:"data-stats"},_={class:"stat-item"},L={class:"stat-value"},C={class:"stat-item"},w={class:"stat-value"},y={class:"data-actions"};function W(a,t,e,W,T,V){const E=(0,s.g2)("el-input"),x=(0,s.g2)("el-form-item"),I=(0,s.g2)("el-checkbox"),S=(0,s.g2)("el-checkbox-group"),P=(0,s.g2)("el-option"),K=(0,s.g2)("el-select"),B=(0,s.g2)("el-button"),R=(0,s.g2)("el-form"),U=(0,s.g2)("el-divider"),X=(0,s.g2)("el-table-column"),A=(0,s.g2)("el-tag"),O=(0,s.g2)("el-progress"),j=(0,s.g2)("el-table"),q=(0,s.g2)("el-card"),z=(0,s.g2)("el-col"),G=(0,s.g2)("el-row");return(0,s.uX)(),(0,s.CE)("div",n,[(0,s.bF)(G,{gutter:20},{default:(0,s.k6)(()=>[(0,s.bF)(z,{span:24},{default:(0,s.k6)(()=>[(0,s.bF)(q,{class:"admin-card"},{header:(0,s.k6)(()=>[...t[6]||(t[6]=[(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("span",null,"组合生成")],-1)])]),default:(0,s.k6)(()=>[(0,s.bF)(R,{model:W.generationForm,"label-width":"120px"},{default:(0,s.k6)(()=>[(0,s.bF)(x,{label:"游戏版本"},{default:(0,s.k6)(()=>[(0,s.bF)(E,{modelValue:W.generationForm.version,"onUpdate:modelValue":t[0]||(t[0]=a=>W.generationForm.version=a),placeholder:"请输入版本号，例如：14.1"},null,8,["modelValue"])]),_:1}),(0,s.bF)(x,{label:"人口范围"},{default:(0,s.k6)(()=>[(0,s.bF)(S,{modelValue:W.generationForm.populations,"onUpdate:modelValue":t[1]||(t[1]=a=>W.generationForm.populations=a)},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(W.populationOptions,a=>((0,s.uX)(),(0,s.Wv)(I,{key:a,label:a},{default:(0,s.k6)(()=>[(0,s.eW)((0,l.v_)(a)+"人口 ",1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,s.bF)(x,{label:"最大羁绊等级"},{default:(0,s.k6)(()=>[(0,s.bF)(K,{modelValue:W.generationForm.trait_tag,"onUpdate:modelValue":t[2]||(t[2]=a=>W.generationForm.trait_tag=a),placeholder:"选择羁绊等级标签",clearable:""},{default:(0,s.k6)(()=>[(0,s.bF)(P,{label:"全部 (默认)",value:""}),(0,s.bF)(P,{label:"黄铜",value:"黄铜"}),(0,s.bF)(P,{label:"白银",value:"白银"}),(0,s.bF)(P,{label:"黄金",value:"黄金"}),(0,s.bF)(P,{label:"棱彩",value:"棱彩"})]),_:1},8,["modelValue"])]),_:1}),(0,s.bF)(x,null,{default:(0,s.k6)(()=>[(0,s.bF)(B,{type:"primary",loading:W.generating,onClick:W.generateCompositions},{default:(0,s.k6)(()=>[...t[7]||(t[7]=[(0,s.eW)(" 开始生成 ",-1)])]),_:1},8,["loading","onClick"]),(0,s.bF)(B,{type:"danger",onClick:W.deleteCompositions},{default:(0,s.k6)(()=>[...t[8]||(t[8]=[(0,s.eW)(" 删除当前版本组合 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),(0,s.bF)(U),(0,s.Lk)("div",o,[t[10]||(t[10]=(0,s.Lk)("h3",null,"生成状态",-1)),(0,s.bF)(j,{data:W.statusList,style:{width:"100%"}},{default:(0,s.k6)(()=>[(0,s.bF)(X,{prop:"population",label:"人口",width:"100"}),(0,s.bF)(X,{prop:"version",label:"版本",width:"120"}),(0,s.bF)(X,{prop:"count",label:"组合数量",width:"120"}),(0,s.bF)(X,{label:"状态",width:"120"},{default:(0,s.k6)(a=>[(0,s.bF)(A,{type:W.getStatusType(a.row.status)},{default:(0,s.k6)(()=>[(0,s.eW)((0,l.v_)(W.getStatusText(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),(0,s.bF)(X,{label:"进度"},{default:(0,s.k6)(a=>[(0,s.bF)(O,{percentage:a.row.progress,status:W.getProgressStatus(a.row.status)},null,8,["percentage","status"])]),_:1}),(0,s.bF)(X,{label:"操作",width:"120"},{default:(0,s.k6)(a=>[(0,s.bF)(B,{size:"small",disabled:"completed"!==a.row.status,onClick:t=>W.viewCompositions(a.row)},{default:(0,s.k6)(()=>[...t[9]||(t[9]=[(0,s.eW)(" 查看组合 ",-1)])]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1})]),_:1}),(0,s.bF)(G,{gutter:20},{default:(0,s.k6)(()=>[(0,s.bF)(z,{span:24},{default:(0,s.k6)(()=>[(0,s.bF)(q,{class:"admin-card"},{header:(0,s.k6)(()=>[...t[11]||(t[11]=[(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("span",null,"数据管理")],-1)])]),default:(0,s.k6)(()=>[(0,s.Lk)("div",i,[(0,s.bF)(G,{gutter:20},{default:(0,s.k6)(()=>[(0,s.bF)(z,{span:8},{default:(0,s.k6)(()=>[(0,s.bF)(q,{class:"data-card"},{header:(0,s.k6)(()=>[...t[12]||(t[12]=[(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("span",null,"棋子管理")],-1)])]),default:(0,s.k6)(()=>[(0,s.Lk)("div",r,[(0,s.Lk)("div",c,[t[13]||(t[13]=(0,s.Lk)("span",{class:"stat-label"},"总数量:",-1)),(0,s.Lk)("span",u,(0,l.v_)(W.championCount),1)])]),(0,s.Lk)("div",d,[(0,s.bF)(B,{type:"primary",onClick:t[3]||(t[3]=a=>W.navigateTo("/champions"))},{default:(0,s.k6)(()=>[...t[14]||(t[14]=[(0,s.eW)("管理棋子",-1)])]),_:1})])]),_:1})]),_:1}),(0,s.bF)(z,{span:8},{default:(0,s.k6)(()=>[(0,s.bF)(q,{class:"data-card"},{header:(0,s.k6)(()=>[...t[15]||(t[15]=[(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("span",null,"羁绊管理")],-1)])]),default:(0,s.k6)(()=>[(0,s.Lk)("div",p,[(0,s.Lk)("div",k,[t[16]||(t[16]=(0,s.Lk)("span",{class:"stat-label"},"总数量:",-1)),(0,s.Lk)("span",v,(0,l.v_)(W.traitCount),1)]),(0,s.Lk)("div",g,[t[17]||(t[17]=(0,s.Lk)("span",{class:"stat-label"},"种族:",-1)),(0,s.Lk)("span",m,(0,l.v_)(W.originTraitCount),1)]),(0,s.Lk)("div",h,[t[18]||(t[18]=(0,s.Lk)("span",{class:"stat-label"},"职业:",-1)),(0,s.Lk)("span",b,(0,l.v_)(W.classTraitCount),1)])]),(0,s.Lk)("div",f,[(0,s.bF)(B,{type:"primary",onClick:t[4]||(t[4]=a=>W.navigateTo("/traits"))},{default:(0,s.k6)(()=>[...t[19]||(t[19]=[(0,s.eW)("管理羁绊",-1)])]),_:1})])]),_:1})]),_:1}),(0,s.bF)(z,{span:8},{default:(0,s.k6)(()=>[(0,s.bF)(q,{class:"data-card"},{header:(0,s.k6)(()=>[...t[20]||(t[20]=[(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("span",null,"组合管理")],-1)])]),default:(0,s.k6)(()=>[(0,s.Lk)("div",F,[(0,s.Lk)("div",_,[t[21]||(t[21]=(0,s.Lk)("span",{class:"stat-label"},"当前版本:",-1)),(0,s.Lk)("span",L,(0,l.v_)(W.currentVersion),1)]),(0,s.Lk)("div",C,[t[22]||(t[22]=(0,s.Lk)("span",{class:"stat-label"},"组合数量:",-1)),(0,s.Lk)("span",w,(0,l.v_)(W.compositionCount),1)])]),(0,s.Lk)("div",y,[(0,s.bF)(B,{type:"primary",onClick:t[5]||(t[5]=a=>W.navigateTo("/compositions"))},{default:(0,s.k6)(()=>[...t[23]||(t[23]=[(0,s.eW)("查看组合",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})])}e(4114),e(8111),e(2489),e(1701);var T=e(953),V=e(6278),E=e(5220),x=e(163),I=e(7918),S={name:"AdminView",setup(){const a=(0,V.Pj)(),t=(0,E.rd)(),e=(0,s.EW)(()=>a.state.champions.champions),l=(0,s.EW)(()=>a.state.traits.traits),n=(0,s.EW)(()=>a.state.compositions.compositions),o=(0,s.EW)(()=>a.state.version),i=(0,T.KR)(!1),r=(0,T.Kh)({version:o.value,populations:[4,5,6,7,8],trait_tag:""}),c=(0,T.KR)([]),u=(0,T.KR)(null),d=[1,2,3,4,5,6,7,8,9,10],p=(0,s.EW)(()=>e.value.length),k=(0,s.EW)(()=>l.value.length),v=(0,s.EW)(()=>l.value.filter(a=>"origin"===a.type).length),g=(0,s.EW)(()=>l.value.filter(a=>"class"===a.type).length),m=(0,s.EW)(()=>n.value.length),h=async()=>{if(r.version)if(0!==r.populations.length)try{i.value=!0,await a.dispatch("setVersion",r.version),await a.dispatch("compositions/generateCompositions",r),x.nk.success("组合生成任务已启动"),c.value=r.populations.map(a=>({population:a,version:r.version,status:"pending",count:0,progress:0})),f()}catch(t){x.nk.error("启动生成任务失败")}finally{i.value=!1}else x.nk.warning("请选择至少一个人口");else x.nk.warning("请输入版本号")},b=async()=>{I.s.confirm(`确定要删除版本 ${o.value} 的所有组合吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await a.dispatch("compositions/deleteCompositionsByVersion"),x.nk.success("组合删除成功"),await a.dispatch("compositions/fetchCompositions",{})}catch(t){x.nk.error("删除组合失败")}}).catch(()=>{})},f=()=>{u.value&&clearInterval(u.value),u.value=setInterval(async()=>{let t=!0;for(const s of c.value)if("completed"!==s.status&&"failed"!==s.status){t=!1;try{const t=await a.dispatch("compositions/checkGenerationStatus",{version:s.version,population:s.population});s.status=t.status,s.count=t.count,s.progress=t.progress}catch(e){console.error("检查状态失败:",e)}}t&&(clearInterval(u.value),u.value=null)},5e3)},F=a=>{switch(a){case"completed":return"success";case"in_progress":return"primary";case"pending":return"info";case"failed":return"danger";default:return"info"}},_=a=>{switch(a){case"completed":return"已完成";case"in_progress":return"生成中";case"pending":return"等待中";case"failed":return"失败";default:return"未知"}},L=(a,t)=>"completed"===a||"failed"===a?100:t||0,C=a=>{switch(a){case"completed":return"success";case"in_progress":return"";case"pending":return"";case"failed":return"exception";default:return""}},w=e=>{a.dispatch("setVersion",e.version),t.push({path:"/compositions",query:{population:e.population}})},y=a=>{t.push(a)};return(0,s.sV)(async()=>{try{await Promise.all([a.dispatch("champions/fetchChampions"),a.dispatch("traits/fetchTraits"),a.dispatch("compositions/fetchCompositions",{})])}catch(t){x.nk.error("加载数据失败")}}),(0,s.hi)(()=>{u.value&&clearInterval(u.value)}),{champions:e,traits:l,compositions:n,currentVersion:o,generating:i,generationForm:r,statusList:c,populationOptions:d,championCount:p,traitCount:k,originTraitCount:v,classTraitCount:g,compositionCount:m,generateCompositions:h,deleteCompositions:b,getStatusType:F,getStatusText:_,getProgressPercentage:L,getProgressStatus:C,viewCompositions:w,navigateTo:y}}},P=e(6262);const K=(0,P.A)(S,[["render",W],["__scopeId","data-v-ee07cfa0"]]);var B=K},1701:function(a,t,e){var s=e(6518),l=e(9565),n=e(9306),o=e(8551),i=e(1767),r=e(9462),c=e(6319),u=e(9539),d=e(684),p=e(4549),k=e(6395),v=!k&&!d("map",function(){}),g=!k&&!v&&p("map",TypeError),m=k||v||g,h=r(function(){var a=this.iterator,t=o(l(this.next,a)),e=this.done=!!t.done;if(!e)return c(a,this.mapper,[t.value,this.counter++],!0)});s({target:"Iterator",proto:!0,real:!0,forced:m},{map:function(a){o(this);try{n(a)}catch(t){u(this,"throw",t)}return g?l(g,this,a):new h(i(this),{mapper:a})}})}}]);
//# sourceMappingURL=601.e4314008.js.map