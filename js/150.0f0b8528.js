"use strict";(self["webpackChunktft_frontend"]=self["webpackChunktft_frontend"]||[]).push([[150],{6150:function(e,t,a){a.r(t),a.d(t,{default:function(){return U}});var l=a(641),i=a(33),s=a(3751);const r={class:"traits-view"},n={class:"trait-name-cell"},o=["src"],c={class:"level-tags"},g={class:"card-header"},m={class:"trait-name-cell"},d=["src"],u={style:{"margin-top":"20px"}},p={key:0,class:"champion-grid-small"},f={class:"champion-avatar-container"},h=["src","alt"],k={class:"trait-levels-form"},b={class:"trait-levels-header"},v={class:"dialog-footer"};function F(e,t,a,F,_,y){const T=(0,l.g2)("el-input"),w=(0,l.g2)("el-form-item"),C=(0,l.g2)("el-option"),V=(0,l.g2)("el-select"),L=(0,l.g2)("el-button"),W=(0,l.g2)("el-form"),E=(0,l.g2)("el-table-column"),U=(0,l.g2)("el-tag"),q=(0,l.g2)("el-table"),X=(0,l.g2)("el-card"),I=(0,l.g2)("el-col"),K=(0,l.g2)("el-empty"),D=(0,l.g2)("el-row"),R=(0,l.g2)("el-divider"),z=(0,l.g2)("el-input-number"),x=(0,l.g2)("Delete"),A=(0,l.g2)("el-icon"),B=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(D,{gutter:20},{default:(0,l.k6)(()=>[(0,l.bF)(I,{span:12},{default:(0,l.k6)(()=>[(0,l.bF)(X,null,{header:(0,l.k6)(()=>[...t[6]||(t[6]=[(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("span",null,"羁绊库")],-1)])]),default:(0,l.k6)(()=>[(0,l.bF)(W,{model:F.filterForm,inline:""},{default:(0,l.k6)(()=>[(0,l.bF)(w,null,{default:(0,l.k6)(()=>[(0,l.bF)(T,{modelValue:F.filterForm.name,"onUpdate:modelValue":t[0]||(t[0]=e=>F.filterForm.name=e),placeholder:"搜索羁绊名称",onInput:F.handleFilter,clearable:""},null,8,["modelValue","onInput"])]),_:1}),(0,l.bF)(w,null,{default:(0,l.k6)(()=>[(0,l.bF)(V,{modelValue:F.filterForm.type,"onUpdate:modelValue":t[1]||(t[1]=e=>F.filterForm.type=e),placeholder:"筛选类型",onChange:F.handleFilter,clearable:""},{default:(0,l.k6)(()=>[(0,l.bF)(C,{label:"种族",value:"origin"}),(0,l.bF)(C,{label:"职业",value:"class"})]),_:1},8,["modelValue","onChange"])]),_:1}),(0,l.bF)(w,null,{default:(0,l.k6)(()=>[(0,l.bF)(L,{onClick:F.resetFilter},{default:(0,l.k6)(()=>[...t[7]||(t[7]=[(0,l.eW)("重置",-1)])]),_:1},8,["onClick"])]),_:1}),(0,l.bF)(w,null,{default:(0,l.k6)(()=>[(0,l.bF)(L,{type:"primary",onClick:F.showAddTraitDialog},{default:(0,l.k6)(()=>[...t[8]||(t[8]=[(0,l.eW)("添加羁绊",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),(0,l.bF)(q,{data:F.traits,onRowClick:F.showTraitDetail,style:{width:"100%",cursor:"pointer"}},{default:(0,l.k6)(()=>[(0,l.bF)(E,{prop:"name",label:"名称"},{default:(0,l.k6)(e=>[(0,l.Lk)("div",n,[(0,l.Lk)("img",{src:F.getTraitIcon(e.row.name),class:"trait-icon"},null,8,o),(0,l.Lk)("span",null,(0,i.v_)(e.row.name),1)])]),_:1}),(0,l.bF)(E,{prop:"type",label:"类型"},{default:(0,l.k6)(e=>[(0,l.bF)(U,{type:"origin"===e.row.type?"success":"primary"},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)("origin"===e.row.type?"种族":"职业"),1)]),_:2},1032,["type"])]),_:1}),(0,l.bF)(E,{label:"等级","min-width":"180"},{default:(0,l.k6)(e=>[(0,l.Lk)("div",c,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.row.levels,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:(0,i.C4)(["level-tag",F.getTagClass(e.tag)])},(0,i.v_)(e.required_count),3))),128))])]),_:1}),(0,l.bF)(E,{label:"操作"},{default:(0,l.k6)(e=>[(0,l.bF)(L,{size:"small",onClick:(0,s.D$)(t=>F.editTrait(e.row),["stop"])},{default:(0,l.k6)(()=>[...t[9]||(t[9]=[(0,l.eW)("编辑",-1)])]),_:2},1032,["onClick"]),(0,l.bF)(L,{size:"small",type:"danger",onClick:(0,s.D$)(t=>F.deleteTrait(e.row.id),["stop"])},{default:(0,l.k6)(()=>[...t[10]||(t[10]=[(0,l.eW)("删除",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onRowClick"])]),_:1})]),_:1}),(0,l.bF)(I,{span:12},{default:(0,l.k6)(()=>[F.selectedTrait?((0,l.uX)(),(0,l.Wv)(X,{key:0},{header:(0,l.k6)(()=>[(0,l.Lk)("div",g,[(0,l.Lk)("div",m,[(0,l.Lk)("img",{src:F.getTraitIcon(F.selectedTrait.name),class:"trait-icon"},null,8,d),(0,l.Lk)("span",null,(0,i.v_)(F.selectedTrait.name),1)])])]),default:(0,l.k6)(()=>[(0,l.Lk)("div",null,[t[11]||(t[11]=(0,l.Lk)("h3",null,"羁绊等级",-1)),(0,l.bF)(q,{data:F.selectedTrait.levels,style:{width:"100%"}},{default:(0,l.k6)(()=>[(0,l.bF)(E,{prop:"level",label:"等级",width:"80"}),(0,l.bF)(E,{prop:"required_count",label:"所需数量",width:"100"}),(0,l.bF)(E,{prop:"effect_description",label:"效果"}),(0,l.bF)(E,{label:"Tag",width:"120"},{default:(0,l.k6)(e=>[e.row.tag?((0,l.uX)(),(0,l.Wv)(U,{key:0,type:F.getTagType(e.row.tag),class:(0,i.C4)(F.getTagClass(e.row.tag))},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(e.row.tag),1)]),_:2},1032,["type","class"])):(0,l.Q3)("",!0)]),_:1})]),_:1},8,["data"])]),(0,l.Lk)("div",u,[t[12]||(t[12]=(0,l.Lk)("h3",null,"拥有该羁绊的棋子",-1)),F.sortedTraitChampions.length?((0,l.uX)(),(0,l.CE)("div",p,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(F.sortedTraitChampions,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"champion-item-small"},[(0,l.Lk)("div",f,[(0,l.Lk)("img",{src:F.getChampionAvatarUrl(e),alt:e.name,class:"champion-avatar-small"},null,8,h),e.cost?((0,l.uX)(),(0,l.CE)("div",{key:0,class:(0,i.C4)(["champion-cost-badge",`cost-${e.cost}`])},(0,i.v_)(e.cost),3)):(0,l.Q3)("",!0)]),(0,l.Lk)("span",null,(0,i.v_)(e.name),1)]))),128))])):((0,l.uX)(),(0,l.Wv)(K,{key:1,description:"暂无棋子"}))])]),_:1})):((0,l.uX)(),(0,l.Wv)(X,{key:1},{default:(0,l.k6)(()=>[(0,l.bF)(K,{description:"请从左侧选择一个羁绊查看详情"})]),_:1}))]),_:1})]),_:1}),(0,l.bF)(B,{modelValue:F.traitFormVisible,"onUpdate:modelValue":t[5]||(t[5]=e=>F.traitFormVisible=e),title:F.isEditing?"编辑羁绊":"添加羁绊",width:"40%"},{footer:(0,l.k6)(()=>[(0,l.Lk)("span",v,[(0,l.bF)(L,{onClick:t[4]||(t[4]=e=>F.traitFormVisible=!1)},{default:(0,l.k6)(()=>[...t[15]||(t[15]=[(0,l.eW)("取消",-1)])]),_:1}),(0,l.bF)(L,{type:"primary",onClick:F.saveTrait},{default:(0,l.k6)(()=>[...t[16]||(t[16]=[(0,l.eW)("保存",-1)])]),_:1},8,["onClick"])])]),default:(0,l.k6)(()=>[(0,l.bF)(W,{model:F.traitForm,"label-width":"100px"},{default:(0,l.k6)(()=>[(0,l.bF)(w,{label:"名称",required:""},{default:(0,l.k6)(()=>[(0,l.bF)(T,{modelValue:F.traitForm.name,"onUpdate:modelValue":t[2]||(t[2]=e=>F.traitForm.name=e),placeholder:"请输入羁绊名称"},null,8,["modelValue"])]),_:1}),(0,l.bF)(w,{label:"类型",required:""},{default:(0,l.k6)(()=>[(0,l.bF)(V,{modelValue:F.traitForm.type,"onUpdate:modelValue":t[3]||(t[3]=e=>F.traitForm.type=e),placeholder:"选择类型"},{default:(0,l.k6)(()=>[(0,l.bF)(C,{label:"种族",value:"origin"}),(0,l.bF)(C,{label:"职业",value:"class"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),(0,l.Lk)("div",k,[(0,l.Lk)("div",b,[t[14]||(t[14]=(0,l.Lk)("h3",null,"羁绊等级",-1)),(0,l.bF)(L,{type:"primary",size:"small",onClick:F.addTraitLevel},{default:(0,l.k6)(()=>[...t[13]||(t[13]=[(0,l.eW)("添加等级",-1)])]),_:1},8,["onClick"])]),(0,l.bF)(R),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(F.traitLevelsForm,(e,t)=>((0,l.uX)(),(0,l.CE)("div",{key:t,class:"trait-level-form-item"},[(0,l.bF)(D,{gutter:10},{default:(0,l.k6)(()=>[(0,l.bF)(I,{span:4},{default:(0,l.k6)(()=>[(0,l.bF)(w,{label:"等级"},{default:(0,l.k6)(()=>[(0,l.bF)(z,{modelValue:e.level,"onUpdate:modelValue":t=>e.level=t,min:1,max:10,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),(0,l.bF)(I,{span:6},{default:(0,l.k6)(()=>[(0,l.bF)(w,{label:"所需数量"},{default:(0,l.k6)(()=>[(0,l.bF)(z,{modelValue:e.required_count,"onUpdate:modelValue":t=>e.required_count=t,min:1,max:20,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),(0,l.bF)(I,{span:5},{default:(0,l.k6)(()=>[(0,l.bF)(w,{label:"标签"},{default:(0,l.k6)(()=>[(0,l.bF)(V,{modelValue:e.tag,"onUpdate:modelValue":t=>e.tag=t,placeholder:"标签",size:"small",clearable:""},{default:(0,l.k6)(()=>[(0,l.bF)(C,{label:"黄铜",value:"黄铜"}),(0,l.bF)(C,{label:"白银",value:"白银"}),(0,l.bF)(C,{label:"黄金",value:"黄金"}),(0,l.bF)(C,{label:"棱彩",value:"棱彩"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),(0,l.bF)(I,{span:7},{default:(0,l.k6)(()=>[(0,l.bF)(w,{label:"效果描述"},{default:(0,l.k6)(()=>[(0,l.bF)(T,{modelValue:e.effect_description,"onUpdate:modelValue":t=>e.effect_description=t,placeholder:"请输入效果描述"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),(0,l.bF)(I,{span:2,class:"level-actions"},{default:(0,l.k6)(()=>[(0,l.bF)(L,{type:"danger",circle:"",size:"small",onClick:e=>F.removeTraitLevel(t)},{default:(0,l.k6)(()=>[(0,l.bF)(A,null,{default:(0,l.k6)(()=>[(0,l.bF)(x)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1},8,["modelValue","title"])])}a(4114),a(8111),a(2489);var _=a(953),y=a(6278),T=a(163),w=a(7918),C=a(8548),V=a(8192),L={name:"TraitsView",components:{Delete:C.epd},setup(){const e=(0,y.Pj)(),t=(0,l.EW)(()=>e.state.loading),a=(0,_.KR)(!0),i=(0,l.EW)(()=>e.state.traits.traitLevels),s=(0,_.KR)("origin"),r=(0,_.Kh)({name:"",type:""}),n=(0,l.EW)(()=>{let t=e.state.traits.traits;return r.name&&(t=t.filter(e=>e.name.toLowerCase().includes(r.name.toLowerCase()))),r.type&&(t=t.filter(e=>e.type===r.type)),t.sort((e,t)=>"origin"===e.type&&"origin"!==t.type?-1:"origin"!==e.type&&"origin"===t.type?1:0)}),o=(0,_.KR)(!1),c=(0,_.KR)(null),g=(0,_.KR)(!1),m=(0,_.KR)([]),d=(0,l.EW)(()=>[...m.value].sort((e,t)=>e.cost-t.cost)),u=(0,_.Kh)({id:null,name:"",type:"origin"}),p=(0,_.KR)([]),f=(0,l.EW)(()=>n.value.filter(e=>"origin"===e.type)),h=(0,l.EW)(()=>n.value.filter(e=>"class"===e.type));(0,l.wB)(c,async e=>{e&&await v(e.id)});const k=async()=>{try{await e.dispatch("traits/fetchTraits")}catch(t){T.nk.error("加载羁绊数据失败")}},b=()=>{r.type=null,e.dispatch("traits/fetchTraits")},v=async t=>{try{const a=await e.dispatch("champions/fetchChampionsByTrait",t);m.value=a}catch(a){T.nk.error("加载棋子数据失败"),m.value=[]}},F=e=>{c.value=e},C=()=>{g.value=!1,u.id=null,u.name="",u.type="origin",p.value=[],o.value=!0},L=async e=>{g.value=!0,u.id=e.id,u.name=e.name,u.type=e.type;const t=e.levels||[];p.value=JSON.parse(JSON.stringify((0,_.ux)(t))),o.value=!0},W=()=>{p.value.push({level:p.value.length+1,required_count:2,effect_description:"",tag:""})},E=e=>{p.value.splice(e,1)},U=async()=>{try{if(!u.name||!u.type)return void T.nk.warning("请填写必填字段");if(g.value){await e.dispatch("traits/updateTrait",{traitId:u.id,name:u.name,traitType:u.type});for(const t of p.value)await e.dispatch("traits/updateTraitLevel",{traitId:u.id,level:t.level,requiredCount:t.required_count,effectDescription:t.effect_description,tag:t.tag});T.nk.success("羁绊更新成功")}else{const t=await e.dispatch("traits/createTrait",{name:u.name,traitType:u.type});for(const a of p.value)await e.dispatch("traits/createTraitLevel",{traitId:t.id,level:a.level,requiredCount:a.required_count,effectDescription:a.effect_description,tag:a.tag});T.nk.success("羁绊添加成功")}o.value=!1,await e.dispatch("traits/fetchTraits"),g.value}catch(t){T.nk.error("保存羁绊失败")}},q=t=>{w.s.confirm(`确定要删除羁绊 ${t.name} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await e.dispatch("traits/deleteTrait",t.id),T.nk.success("羁绊删除成功"),await e.dispatch("traits/fetchTraits")}catch(a){T.nk.error("删除羁绊失败")}}).catch(()=>{})},X=e=>{switch(e){case"黄铜":return"success";case"白银":return"info";case"黄金":return"warning";case"棱彩":return"danger";default:return""}},I=e=>{switch(e){case"黄铜":return"tag-bronze";case"白银":return"tag-silver";case"黄金":return"tag-gold";case"棱彩":return"tag-prismatic";default:return"tag-default"}};return(0,l.sV)(async()=>{try{await Promise.all([e.dispatch("traits/fetchTraits"),e.dispatch("champions/fetchChampions")])}catch(t){T.nk.error("加载数据失败")}}),{traits:n,loading:t,isAdmin:a,traitLevels:i,activeTab:s,filterForm:r,traitFormVisible:o,selectedTrait:c,isEditing:g,traitChampions:m,sortedTraitChampions:d,traitForm:u,traitLevelsForm:p,originTraits:f,classTraits:h,handleFilter:k,resetFilter:b,showTraitDetail:F,showAddTraitDialog:C,editTrait:L,addTraitLevel:W,removeTraitLevel:E,saveTrait:U,deleteTrait:q,getTagType:X,getTagClass:I,getTraitIcon:V.Sc,getChampionAvatarUrl:V.qB}}},W=a(6262);const E=(0,W.A)(L,[["render",F],["__scopeId","data-v-68e24c42"]]);var U=E},8192:function(e,t,a){a.d(t,{Sc:function(){return i},qB:function(){return s}});const l={"护卫":"https://game.gtimg.cn/images/lol/act/img/tft/classes/10204.png","裁决使者":"https://game.gtimg.cn/images/lol/act/img/tft/classes/10205.png","决斗大师":"https://game.gtimg.cn/images/lol/act/img/tft/classes/10206.png","刀锋领主":"https://game.gtimg.cn/images/lol/act/img/tft/classes/10207.png","重量级斗士":"https://game.gtimg.cn/images/lol/act/img/tft/classes/10208.png","主宰":"https://game.gtimg.cn/images/lol/act/img/tft/classes/10209.png","天才":"https://game.gtimg.cn/images/lol/act/img/tft/classes/10210.png","圣盾使":"https://game.gtimg.cn/images/lol/act/img/tft/classes/10211.png","狙神":"https://game.gtimg.cn/images/lol/act/img/tft/classes/10212.png","法师":"https://game.gtimg.cn/images/lol/act/img/tft/classes/10213.png","司令":"https://game.gtimg.cn/images/lol/act/img/tft/classes/10214.png","战斗学院":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10188.png","卡牌大师":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10189.png","龙的传人":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10190.png","魄罗之心":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10191.png","至高天":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10192.png","水晶玫瑰":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10193.png","假面摔角手":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10194.png","小怪兽训练师":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10195.png","大宗师":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10196.png","荆棘之兴":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10197.png","超级战队":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10198.png","斗魂战士":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10199.png","星之守护者":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10200.png","兵王":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10201.png","奥德赛":"https://game.gtimg.cn/images/lol/act/img/tft/origins/10202.png"},i=e=>l[e]||"",s=e=>{if(!e||!e.image_url)return"";if(e.image_url.endsWith(".png"))return e.image_url;const t=e.image_url.split("/"),a=t.pop(),l=a.split(".")[0];return l&&/^\d+$/.test(l)?`https://game.gtimg.cn/images/lol/act/img/tft/champions/${l}.png`:e.image_url}}}]);
//# sourceMappingURL=150.0f0b8528.js.map